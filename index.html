<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase é€£ç·šè¨ºæ–·å·¥å…·</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; background: #f4f4f9; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h2 { margin-top: 0; color: #333; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        input { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
        button { margin-top: 20px; width: 100%; padding: 10px; background: #2ecc71; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; }
        button:hover { background: #27ae60; }
        #result { margin-top: 20px; padding: 15px; border-radius: 4px; white-space: pre-wrap; word-break: break-all; display: none; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>

<div class="card">
    <h2>Supabase é€£ç·šè¨ºæ–·</h2>
    <p>è«‹è¼¸å…¥ä½ çš„ Supabase è³‡æ–™ï¼Œé»æ“Šæ¸¬è©¦æŒ‰éˆ•ï¼Œæˆ‘æœƒå‘Šè¨´ä½ å“ªè£¡å‡ºéŒ¯äº†ã€‚</p>

    <label>Supabase URL (ç¶²å€):</label>
    <input type="text" id="url" placeholder="https://xyz.supabase.co">

    <label>Supabase Anon Key (é‡‘é‘°):</label>
    <input type="text" id="key" placeholder="eyJhbGciOiJIUzI1NiIsIn...">

    <label>Table Name (è³‡æ–™è¡¨åç¨±):</label>
    <input type="text" id="table" value="credit_cards_2025" placeholder="credit_cards_2025">

    <button onclick="testConnection()">é–‹å§‹æ¸¬è©¦é€£ç·š</button>

    <div id="result"></div>
</div>

<script>
    async function testConnection() {
        const url = document.getElementById('url').value.trim();
        const key = document.getElementById('key').value.trim();
        const table = document.getElementById('table').value.trim();
        const resultDiv = document.getElementById('result');

        resultDiv.style.display = 'block';
        resultDiv.className = '';
        resultDiv.innerText = 'æ¸¬è©¦ä¸­...';

        if (!url || !key || !table) {
            showError('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½ï¼');
            return;
        }

        try {
            // å»ºç«‹é€£ç·š
            const supabase = window.supabase.createClient(url, key);
            
            // å˜—è©¦æŠ“å– 1 ç­†è³‡æ–™
            const { data, error } = await supabase
                .from(table)
                .select('*')
                .limit(1);

            if (error) {
                // æ•æ‰åˆ° Supabase å›å‚³çš„éŒ¯èª¤
                let msg = `âŒ é€£ç·šå¤±æ•— (éŒ¯èª¤ä»£ç¢¼: ${error.code})\n`;
                msg += `éŒ¯èª¤è¨Šæ¯: ${error.message}\n\n`;
                
                if (error.code === 'PGRST301' || error.message.includes('relation') && error.message.includes('does not exist')) {
                    msg += 'ğŸ‘‰ åŸå› æ¨æ¸¬ï¼šè³‡æ–™è¡¨åç¨±éŒ¯èª¤ã€‚\nè«‹æª¢æŸ¥ Supabase è³‡æ–™åº«è£¡çœŸçš„æœ‰ä¸€å€‹å« "' + table + '" çš„è¡¨å—ï¼Ÿ';
                } else if (error.code === '401' || error.message.includes('JWT')) {
                    msg += 'ğŸ‘‰ åŸå› æ¨æ¸¬ï¼šKey å¡«éŒ¯äº†ï¼Œæˆ–è€…æ˜¯ URL å¡«éŒ¯ã€‚\nè«‹ç¢ºèªè¤‡è£½çš„æ˜¯ "anon" key è€Œä¸æ˜¯ "service_role" keyã€‚';
                } else if (error.code === '42501' || error.message.includes('permission denied')) {
                    msg += 'ğŸ‘‰ åŸå› æ¨æ¸¬ï¼šæ¬Šé™ (RLS) è¢«æ“‹ä½äº†ã€‚\nå³ä½¿ Key å°äº†ï¼Œä½†è³‡æ–™åº«è¨­å®šä¸å…è¨±è®€å–ã€‚';
                }
                
                showError(msg);
            } else {
                // æˆåŠŸ
                let msg = 'âœ… é€£ç·šæˆåŠŸï¼\n';
                if (data.length === 0) {
                    msg += 'ä½†æ˜¯è³‡æ–™è¡¨æ˜¯ç©ºçš„ (æ²’æœ‰ä»»ä½•è³‡æ–™)ã€‚\nè«‹å» Supabase æ’å…¥å¹¾ç­†è³‡æ–™æ¸¬è©¦ã€‚';
                } else {
                    msg += `æˆåŠŸè®€å–åˆ°è³‡æ–™ï¼\nç¬¬ä¸€ç­†è³‡æ–™ ID: ${data[0].id || 'ç„¡ ID æ¬„ä½'}\n\né€™ä»£è¡¨ä½ çš„ Key å’Œ URL éƒ½æ˜¯å°çš„ã€‚å•é¡Œå¯èƒ½å‡ºåœ¨åŸæœ¬ç¶²é çš„ç¨‹å¼ç¢¼å¯«æ³•ã€‚`;
                }
                showSuccess(msg);
            }

        } catch (err) {
            // æ•æ‰åˆ°ç¶²è·¯æˆ–ç¨‹å¼éŒ¯èª¤
            showError(`âŒ ç™¼ç”Ÿæœªé æœŸçš„éŒ¯èª¤ï¼š\n${err.message}\n\nğŸ‘‰é€™é€šå¸¸æ˜¯ URL æ ¼å¼å®Œå…¨éŒ¯èª¤ï¼Œæˆ–æ˜¯ç¶²è·¯é€£ä¸ä¸Šã€‚`);
        }
    }

    function showError(msg) {
        const div = document.getElementById('result');
        div.className = 'error';
        div.innerText = msg;
    }

    function showSuccess(msg) {
        const div = document.getElementById('result');
        div.className = 'success';
        div.innerText = msg;
    }
</script>

</body>
</html>
